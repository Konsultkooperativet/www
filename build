set -x

cd cv

npm install -g resume-cli
npm install -g handlebars
npm install -g moment
npm install -g uncss

npm install -g ./jsonresume-theme-konsultcoop

for f in consultants/*.json; 
do 
	echo "Processing $f file.."; 

	NAME=`echo "$f" | cut -d'.' -f1`
	NAME=`echo "$NAME" | cut -d'/' -f2`

	cp $f resume.json
	resume export --theme konsultcoop $NAME.html
	cp $NAME.html ../public/cv/$NAME.html
done
cd ..

COMMON_CSS=`cat css/common.html`

cd public

for i in $(find . -name '*.html'); do # This breaks if filenames have whitespaces!
	echo "Parsing CSS for $1\n"
	sed 's/\<\!---CSS--\>/$COMMON_CSS/g' $1 > $1.html
	NEW_CSS=`uncss $1.html`
	sed 's/\<\!---CSS--\>/$NEW_CSS/g' $1 > $1.html
	rm $1
	mv $1.html $1
done